---
description: 
globs: 
alwaysApply: false
---
# ğŸ› ï¸ JavaScript to React-Like Refactoring Cursorules

## Purpose

This document defines strict refactoring rules for transforming legacy JavaScript "spaghetti" code into a React-like structure. The goal is **to improve maintainability without altering existing business logic**, inspired by JSX-style rendering, event delegation, and isolated state handling.

> âš ï¸ Never modify existing business logic.
> âš ï¸ Only restructure code without changing its behavior.

---

## ğŸ‘‘ Role Assumed

The refactoring is executed by a senior JavaScript expert (CTO-level) responsible for safe architectural migration, ensuring minimal friction and zero regression.

---

## âœ… Principles

### 1. Componentization First

Extract related DOM + logic into modular components.

* âœ… Good: `function ProductCard(props) { ... }`
* âŒ Bad: `function renderProductBlock() { ... }`

### 2. JSX-Like Function Structure

Structure the component's return to reflect JSX semantics via:

* Template literals
* `document.createElement`
* Consistent nesting and layout hierarchy

### 3. Event Delegation Pattern

Avoid direct event listeners inside loops or for every element.

* âœ… `container.addEventListener('click', handleClick)`
* âŒ `el.addEventListener('click', ...)` inside `.forEach`

### 4. State Isolation

Simulate `useState` behavior via top-level scope isolation.

* âœ… `let isOpen = false` with updater function
* âŒ Mutating state directly inside a handler

### 5. Immutable Thinking

Prefer immutable operations. Avoid in-place mutations unless absolutely necessary.

### 6. Render Function Convention

* Use PascalCase or `renderX` naming
* Must accept `props` (or equivalent arguments)
* Must be pure and side-effect free

### 7. Early Return in Handlers

Avoid deep nesting in event handlers.

* âœ… `if (!target) return;`
* âŒ Deep `if-else` or `switch-case` chains

### 8. Naming Convention

* âœ… Use **camelCase** for variables, functions, and handlers
* âœ… Use **PascalCase** only for component-like pure render functions (like React)
* âŒ Avoid snake\_case or inconsistent casing

---

## ğŸ§© Directory Structure

```plaintext
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ProductCard.js       â† React-like component
â”œâ”€â”€ dom/
â”‚   â””â”€â”€ domHelpers.js        â† DOM abstraction helpers
â”œâ”€â”€ state/
â”‚   â””â”€â”€ stateStore.js        â† isolated state manager
â””â”€â”€ events/
    â””â”€â”€ clickDelegates.js    â† centralized event delegation
```

---

## ğŸ”’ Safety Rules

* âŒ Never rename variables or functions unless unused
* âŒ Never alter logic branches or flow
* âœ… Use `// TODO:` comments to mark refactored boundaries
* âœ… Add `/** Pure render function */` JSDoc for all JSX-like components

---

## ğŸ§ª Testing & QA

> ğŸ” Refactoring without regression is non-negotiable.

* âœ… **Always run tests via `pnpm test` before and after changes**
* âœ… **Run tests frequently during refactor**, especially after any structural or state change
* âŒ **Do not commit if any test fails**, even if the failure seems unrelated
* âœ… Perform DOM snapshot diffing (if available)
* âœ… Use `console.assert` to validate structural equivalence
* âš ï¸ Temporary logs allowed **within component scope only**, and must be removed before commit
* âœ… Component output must be **visually and functionally identical** pre/post refactor

---

## ğŸ“ Example Conversion

### Before

```js
const button = document.createElement('button');
button.innerText = 'Click me';
button.onclick = function () {
  alert('clicked');
};
document.body.appendChild(button);
```

### After

```ts
/** Pure render function */
function ClickButton(): HTMLElement {
  const button = document.createElement('button');
  button.innerText = 'Click me';
  button.addEventListener('click', handleClick);
  return button;
}

function handleClick() {
  alert('clicked');
}

document.body.appendChild(ClickButton());
```

---

## ğŸ§­ Migration Phases

1. **Phase 1** â€“ Extract component boundaries
2. **Phase 2** â€“ Centralize event delegation
3. **Phase 3** â€“ Isolate state per component
4. **Phase 4** â€“ JSX/React compatibility pass

---

## ğŸ›‘ Anti-Patterns

| Pattern                          | Why to Avoid                  |
| -------------------------------- | ----------------------------- |
| `.innerHTML = ...`               | XSS-prone, hard to test       |
| Global `let count = 0`           | Shared state = bugs           |
| Direct DOM mutation              | Untrackable, brittle          |
| Nested functions in render logic | Unreadable and non-composable |

---

## ğŸ“Œ PR Checklist

* [ ] No logic modifications
* [ ] JSX-style component naming used
* [ ] Event handlers prefixed with `handle`
* [ ] No loop-level `.addEventListener`
* [ ] `// TODO:` comment added where necessary
* [ ] âœ… `pnpm test` passes locally **before each commit**

---

## ğŸ“ Git Commit Tags

Use these prefixes in commit messages:

* `refactor(component):` Refactor logic into a React-like component
* `refactor(event):` Apply event delegation pattern
* `refactor(state):` Isolate or lift state cleanly
* `test(regression):` Add missing test or fix test artifact
* `docs(cursorules):` Update cursorule documentation

---

## âœï¸ Notes

This document evolves alongside the codebase.
Suggest additions and improvements via pull request under the tag:

```text
docs(cursorules): update rulebook
```
